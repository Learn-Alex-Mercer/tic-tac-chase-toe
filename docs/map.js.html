<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>map.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Map.html">Map</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Map.html#_buildMapMatrix">_buildMapMatrix</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Map.html#_generateMap">_generateMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Map.html#_verifiedMapMatrix">_verifiedMapMatrix</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Map.html#onEmptyBoxClicked">onEmptyBoxClicked</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Player.html">Player</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#_dropOldWeapon">_dropOldWeapon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#_findValidMoves">_findValidMoves</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#_prepareToDropOldWeapon">_prepareToDropOldWeapon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#moveTo">moveTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#pickUpWeapon">pickUpWeapon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#placeSelfOnMap">placeSelfOnMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Player.html#takeTurn">takeTurn</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Weapon.html">Weapon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#_move">_move</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#getLocation">getLocation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#hide">hide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#moveTo">moveTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#moveToOwner">moveToOwner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#placeSelfOnMap">placeSelfOnMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Weapon.html#show">show</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getBoxElement">getBoxElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRandomBox">getRandomBox</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isBoxAvailable">isBoxAvailable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isBoxInUse">isBoxInUse</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">map.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const CLICK_EVENT = "click";

/**
 * Create a Map class.
 */
export default class Map {
  /**
   * Create a map, add it the DOM and return the map matrix.
   * @param {number} rows - The number of rows for the map.
   * @param {number} columns - The number of columns for the map.
   * @param {number} percentage - The percentage for the available boxes.
   * @param {Element} containerElement - The DOM container element for the rendered map.
   * @param {Array} weapons - The list of weapons on the map.
   * @param {Array} players - The list of players on the map.
   * @returns {Array} Map Matrix
   */
  constructor(rows = 100, columns = 100, percentage = 90, containerElement, weapons, players) {
    this.rows = rows;
    this.columns = columns;
    this.percentage = percentage;
    this.container = containerElement;
    this.weapons = weapons;
    this.players = players;

    this.matrix = this._verifiedMapMatrix();

    this._generateMap();

    this.container.addEventListener(CLICK_EVENT, this.onEmptyBoxClicked);

    return this.matrix;
  }

  /**
   * Verify the generated map matrix to make sure it contains required
   * percentage of blocked boxes. Otherwise, build a new map matrix
   * until it meets the requirements.
   * @private
   * @returns {Array} Map Matrix
   */
  _verifiedMapMatrix() {
    const mapMatrix = this._buildMapMatrix();
    const boxesValid = mapMatrix.flat().filter(state => state === false).length >= (100 - this.percentage);

    if (boxesValid) {
      return mapMatrix;
    } else {
      return this._verifiedMapMatrix();
    }
  }

  /**
   * Build a map matrix based on the specified number of rows and columns
   * along with the percentage of chance that a given box would be available
   * and not blocked.
   * @private
   * @returns {Array} Map Matrix
   */
  _buildMapMatrix() {
    let newMapMatrix = [];

    for (let row = 0; row &lt; this.rows; row++) {
      let matrixRow = [];

      for (let column = 0; column &lt; this.columns; column++) {
        // Get a random number between 1 and (ROWS * COLUMNS).
        const randChance = Math.floor(Math.random() * (this.rows * this.columns));

        // Set the column as available if the random number is `percentage` or less.
        // Otherwise, the column will be unavailable for players to use.
        matrixRow.push(randChance &lt;= this.percentage ? true : false);
      }

      // Add the completed row to the new map matrix.
      newMapMatrix.push(matrixRow);
    }

    return newMapMatrix;
  }

  /**
   * Build a map based on the map matrix and add it to the DOM.
   * @private
   */
  _generateMap() {
    // Clear the map of all content, if any. So we can start fresh.
    let firstChild = this.container.firstChild;
    while(firstChild) {
      this.container.removeChild(firstChild);
      firstChild = this.container.firstChild;
    }

    this.matrix.forEach((row, rowIndex) => {
      // Create a new div with the "row" class for each row in the matrix.
      let elmRow = document.createElement("div");
      elmRow.className = "row";

      row.forEach((column, columnIndex) => {
        // Based on the column being available or blocked for use by the players.
        // Create a new div with appropriate CSS class's to visually distinguish them.
        let elmColumn = document.createElement("div");
        elmColumn.className = column === true ? "box empty" : "box blocked";
        elmColumn.setAttribute('data-row', rowIndex);
        elmColumn.setAttribute('data-column', columnIndex);
        elmRow.appendChild(elmColumn);
      });

      // Add the completed row to the Map element in the DOM.
      this.container.appendChild(elmRow);
    });
  }

  /**
   * Move the player to the selected valid box. Where they will pick up any weapon inside
   * the box. And, change the game turn for the next player.
   * @param {Event} e
   * @function
  */
  onEmptyBoxClicked = (e) => {
    const elmBox = e.target;

    if (elmBox.classList.contains("valid")) {
      const newRow = parseInt(elmBox.getAttribute("data-row"));
      const newColumn = parseInt(elmBox.getAttribute("data-column"));

      // Find current player.
      let currentPlayer = this.players.find((player) => {
        return player.className === this.container.querySelector(".current-player").getAttribute("data-player-id");
      });

      if (elmBox.querySelector(".weapon") !== null) {
        currentPlayer.pickUpWeapon(this.weapons, newRow, newColumn);
      }

      currentPlayer.moveTo(newRow, newColumn);

      // Change turn
      currentPlayer = currentPlayer === this.players[0] ? this.players[1] : this.players[0];
      currentPlayer.takeTurn(this.matrix);
    }
  }
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a> on Sat Jul 13 2019 02:30:15 GMT+0300 (+03) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
